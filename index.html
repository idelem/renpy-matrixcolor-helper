<html>
  <head>
    <title>matrixcolor</title>
    <style>
      #dropZone {
        width: 500px;
        height: 300px;
        border: 2px dashed #ccc;
        border-radius: 20px;
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 20px;
        margin: 20px auto;
      }
    </style>
  </head>
  <body>
    <div id="dropZone">Drop an image here</div>
    <canvas id="canvas"></canvas>
  </body>
  <script>
    const dropZone = document.getElementById('dropZone');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.style.background = '#e1e1e1';
    });

    dropZone.addEventListener('dragleave', (e) => {
      dropZone.style.background = 'transparent';
    });
    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.background = 'transparent';
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = (event) => {
            const img = new Image();
            img.onload = () => {
                const maxWidth = window.innerWidth * 0.9;
                const maxHeight = window.innerHeight * 0.9;
                const scale = Math.min(maxWidth / img.width, maxHeight / img.height);
                
                canvas.width = img.width * scale;
                canvas.height = img.height * scale;
                
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                
                // Apply color matrix after drawing the image
                applyColorMatrix();
                // Hide the drop zone and display the canvas
                dropZone.style.display = 'none';
                canvas.style.display = 'block';
            };
            img.src = event.target.result;
        };
        reader.readAsDataURL(file);
        }
    });

    function applyColorMatrix() {
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;

        // Example color matrix (sepia tone)
        const matrix = [
        0.393, 0.769, 0.189, 0,
        0.349, 0.686, 0.168, 0,
        0.272, 0.534, 0.131, 0,
        0,     0,     0,     1
        ];

        for (let i = 0; i < data.length; i += 4) {
            const r = data[i];
            const g = data[i + 1];
            const b = data[i + 2];
            const a = data[i + 3];

            data[i]     = r * matrix[0] + g * matrix[1] + b * matrix[2] + a * matrix[3];
            data[i + 1] = r * matrix[4] + g * matrix[5] + b * matrix[6] + a * matrix[7];
            data[i + 2] = r * matrix[8] + g * matrix[9] + b * matrix[10] + a * matrix[11];
            data[i + 3] = r * matrix[12] + g * matrix[13] + b * matrix[14] + a * matrix[15];
        }

        ctx.putImageData(imageData, 0, 0);
    }

  </script>
</html>